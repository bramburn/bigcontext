# Task List: Sub-Sprint 3 - Centralized Webview Management

**Goal:** To create the `WebviewManager` class and move all webview panel creation and lifecycle logic into it, cleaning up the command handlers and `extension.ts`.

| Task ID | Status | Task Description (Sequential & Atomic Steps) | File(s) To Modify |
| :--- | :--- | :--- | :--- |
| **3.1** | ☐ To Do | **Create `WebviewManager.ts` File:** Create the new file `src/webviewManager.ts`. Define the `WebviewManager` class. Its constructor should accept `vscode.ExtensionContext`. Include private properties to hold references to `mainPanel` and `settingsPanel` (both `vscode.WebviewPanel | undefined`). Implement a `dispose()` method to clean up these panels. | `src/webviewManager.ts` (New) |
| **3.2** | ☐ To Do | **Implement `getWebviewContent` Helper:** In `src/webviewManager.ts`, create a private helper method `getWebviewContent(webview: vscode.Webview, panelName: string): string`. This method should read `webview/dist/index.html` using `fs.readFileSync()`. It must then replace placeholders (e.g., `{{scriptUri}}`, `{{styleUri}}`) with URIs generated by `webview.asWebviewUri()` for `webview/dist/index.js` and `webview/dist/styles.css`. | `src/webviewManager.ts` |
| **3.3** | ☐ To Do | **Implement `showMainPanel` Method:** In `src/webviewManager.ts`, create a public method `showMainPanel(): void`. This method should check if `this.mainPanel` already exists. If it does, call `this.mainPanel.reveal(vscode.ViewColumn.One)` and return. If not, create a new `vscode.WebviewPanel` using `vscode.window.createWebviewPanel()`, set its `webview.html` using `getWebviewContent()`, and store the panel in `this.mainPanel`. Add an `onDidDispose` listener to the panel to set `this.mainPanel` back to `undefined` when the panel is closed. | `src/webviewManager.ts` |
| **3.4** | ☐ To Do | **Implement `showSettingsPanel` Method:** In `src/webviewManager.ts`, create a public method `showSettingsPanel(): void`. This method should follow the same logic as `showMainPanel`, but for the settings UI, using a different panel ID and title, and potentially a different `vscode.ViewColumn` (e.g., `vscode.ViewColumn.Two`). Store the panel in `this.settingsPanel`. | `src/webviewManager.ts` |
| **3.5** | ☐ To Do | **Update `ExtensionManager` for `WebviewManager`:** Open `src/extensionManager.ts`. In the `ExtensionManager` constructor, instantiate `WebviewManager`, passing it the `vscode.ExtensionContext` (e.g., `this.webviewManager = new WebviewManager(this.context);`). Make `webviewManager` a public property so it can be accessed by `CommandManager`. Add `this.webviewManager` to the `disposables` array. | `src/extensionManager.ts` |
| **3.6** | ☐ To Do | **Refactor `CommandManager` for Webview Commands:** Open `src/commandManager.ts`. Modify the constructor to accept `WebviewManager` as a dependency. Update the callbacks for `code-context-engine.openMainPanel` and `code-context-engine.openSettings` commands to call `this.webviewManager.showMainPanel()` and `this.webviewManager.showSettingsPanel()` respectively, replacing the placeholder messages. | `src/commandManager.ts` |
| **3.7** | ☐ To Do | **Verify Webview HTML Placeholders:** Open `webview/dist/index.html`. Ensure it contains `{{scriptUri}}` and `{{styleUri}}` placeholders in the appropriate `<script>` and `<link>` tags for the `getWebviewContent` method to replace. | `webview/dist/index.html` |
