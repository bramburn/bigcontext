# Task List: Sprint 5 - Settings UI & Configuration

**Goal:** To build the settings UI and connect it to the VS Code configuration system.

| Task ID | Status | Task Description (Sequential & Atomic Steps) | File(s) To Modify |
| :--- | :--- | :--- | :--- |
| **5.1** | ☐ To Do | **Define Configuration Schema:** In `package.json`, under the `contributes.configuration` section, define the properties for the settings (e.g., `code-context.embeddingProvider`, `code-context.databaseConnectionString`), including their types, defaults, and descriptions. | `package.json` |
| **5.2** | ☐ To Do | **Register `openSettings` command:** In `package.json`, add a new command to the `contributes.commands` section (e.g., `code-context-engine.openSettings`) that will be used to open the settings UI. | `package.json` |
| **5.3** | ☐ To Do | **Implement command in `extension.ts`:** In `src/extension.ts`, register the `openSettings` command. The command handler should create and show a new `WebviewPanel` specifically for the settings UI, loading the SvelteKit app into it. | `src/extension.ts` |
| **5.4** | ☐ To Do | **Create `Settings.svelte` component:** Create a new Svelte component (e.g., `webview/src/routes/settings/+page.svelte` or `webview/src/lib/Settings.svelte`). Build the UI using Fluent UI components like `<fluent-select>` for embedding providers and `<fluent-text-field>` for the database URI. | `webview/src/routes/settings/+page.svelte` or `webview/src/lib/Settings.svelte` |
| **5.5** | ☐ To Do | **Load Initial Settings:** In the `Settings.svelte` component, use the `onMount` lifecycle hook to send a message to the extension backend (via `vscodeApi.ts`) requesting the current configuration values. Listen for the response and populate the UI fields with the loaded settings. | `webview/src/routes/settings/+page.svelte` or `webview/src/lib/Settings.svelte` |
| **5.6** | ☐ To Do | **Implement `getSettings` handler in `extension.ts`:** In `src/extension.ts`, add a message handler for the `getSettings` command. This handler should read the current configuration values from `vscode.workspace.getConfiguration('code-context-engine')` and send them back to the webview. | `src/extension.ts` |
| **5.7** | ☐ To Do | **Save Settings from UI:** In the `Settings.svelte` component, add a button (e.g., "Save Settings"). On click, gather the current values from the UI fields and send them as a message (e.g., `saveSettings`) to the extension backend. | `webview/src/routes/settings/+page.svelte` or `webview/src/lib/Settings.svelte` |
| **5.8** | ☐ To Do | **Implement `saveConfiguration` handler in `extension.ts`:** In `src/extension.ts`, add a message handler for the `saveSettings` command. This handler should receive the updated settings from the webview and use `vscode.workspace.getConfiguration().update()` to persist them to the VS Code configuration (e.g., `vscode.ConfigurationTarget.Global`). | `src/extension.ts` |
| **5.9** | ☐ To Do | **Refactor Services to Use Config:** Update `src/indexing/indexingService.ts` and `src/db/qdrantService.ts` (and any other relevant services) to read their configuration (e.g., embedding provider, database connection string) from `vscode.workspace.getConfiguration('code-context-engine')` instead of hardcoded values. | `src/indexing/indexingService.ts`, `src/db/qdrantService.ts` |
