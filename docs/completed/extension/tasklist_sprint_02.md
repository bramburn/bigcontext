# Task List: Sub-Sprint 2 - Extension & Command Managers

**Goal:** To create the initial `ExtensionManager` and `CommandManager` classes, moving the core lifecycle and command registration logic out of `extension.ts`.

| Task ID | Status | Task Description (Sequential & Atomic Steps) | File(s) To Modify |
| :--- | :--- | :--- | :--- |
| **2.1** | ☐ To Do | **Create `ExtensionManager.ts` File:** Create the new file `src/extensionManager.ts`. Define the `ExtensionManager` class. Its constructor should accept `vscode.ExtensionContext`. Implement an `initialize()` method where all core services (e.g., `ConfigService`, `QdrantService`, `IndexingService`, `ContextService`) are instantiated using the Dependency Injection pattern established in Sub-Sprint 1. Implement a `dispose()` method to clean up resources. | `src/extensionManager.ts` (New) |
| **2.2** | ☐ To Do | **Create `CommandManager.ts` File:** Create the new file `src/commandManager.ts`. Define the `CommandManager` class. Its constructor should accept instances of services it needs to interact with (e.g., `IndexingService`). Implement a `registerCommands()` method that will contain all `vscode.commands.registerCommand` calls and return an array of `vscode.Disposable` objects. | `src/commandManager.ts` (New) |
| **2.3** | ☐ To Do | **Move `openMainPanel` Command:** Open `src/extension.ts`. Locate the `vscode.commands.registerCommand` call for `code-context-engine.openMainPanel`. Cut this entire registration. Paste it into the `registerCommands()` method of `src/commandManager.ts`. For now, the callback can show a simple `vscode.window.showInformationMessage('Open Main Panel (placeholder)');`. | `src/extension.ts`, `src/commandManager.ts` |
| **2.4** | ☐ To Do | **Move `startIndexing` Command:** Open `src/extension.ts`. Locate the `vscode.commands.registerCommand` call for `code-context-engine.startIndexing`. Cut this entire registration. Paste it into the `registerCommands()` method of `src/commandManager.ts`. The callback should call `this.indexingService.startIndexing()`. | `src/extension.ts`, `src/commandManager.ts` |
| **2.5** | ☐ To Do | **Move `openSettings` Command:** Open `src/extension.ts`. Locate the `vscode.commands.registerCommand` call for `code-context-engine.openSettings`. Cut this entire registration. Paste it into the `registerCommands()` method of `src/commandManager.ts`. For now, the callback can show a simple `vscode.window.showInformationMessage('Open Settings (placeholder)');`. | `src/extension.ts`, `src/commandManager.ts` |
| **2.6** | ☐ To Do | **Instantiate `CommandManager` in `ExtensionManager`:** Open `src/extensionManager.ts`. In the `ExtensionManager` constructor, instantiate `CommandManager`, passing it the necessary service instances (e.g., `this.indexingService`). In the `initialize()` method, call `this.commandManager.registerCommands()` and add the returned disposables to `this.disposables` array. | `src/extensionManager.ts` |
| **2.7** | ☐ To Do | **Refactor `extension.ts` - `activate` Function:** Open `src/extension.ts`. Simplify the `activate` function. It should now only instantiate `ExtensionManager` (passing `context`) and then call its `initialize()` method. Remove all direct service instantiations and command registrations from `activate`. | `src/extension.ts` |
| **2.8** | ☐ To Do | **Refactor `extension.ts` - `deactivate` Function:** Open `src/extension.ts`. Simplify the `deactivate` function. It should now only call `extensionManager.dispose()` (assuming `extensionManager` is a module-scoped variable). | `src/extension.ts` |
| **2.9** | ☐ To Do | **Verify `extension.ts` Line Count:** Ensure that after refactoring, the `src/extension.ts` file contains less than 50 lines of code. | `src/extension.ts` |
