# Task List: Sprint 2 - AST Parser & Code Chunking

**Goal:** To implement the core logic for parsing code into Abstract Syntax Trees (ASTs) and chunking them into meaningful segments.

| Task ID | Status | Task Description (Sequential & Atomic Steps) | File(s) To Modify |
| :--- | :--- | :--- | :--- |
| **2.1** | ☐ To Do | **Install Tree-sitter and Language Grammars:** In your project's root directory, run `npm install tree-sitter tree-sitter-typescript tree-sitter-python tree-sitter-c-sharp` to install the core parser and necessary language grammars. | `package.json` |
| **2.2** | ☐ To Do | **Install File System Helper Libraries:** In your project's root directory, run `npm install glob ignore` to install libraries for file matching and `.gitignore` parsing. | `package.json` |
| **2.3** | ☐ To Do | **Create `FileWalker` Service File:** Create a new TypeScript file at `src/indexing/fileWalker.ts`. | `src/indexing/fileWalker.ts` |
| **2.4** | ☐ To Do | **Implement `FileWalker` Constructor:** In `src/indexing/fileWalker.ts`, add a constructor that takes `workspaceRoot: string` and initializes an `ignore` instance. | `src/indexing/fileWalker.ts` |
| **2.5** | ☐ To Do | **Implement `FileWalker.loadGitignore` Method:** In `src/indexing/fileWalker.ts`, add an asynchronous private method `loadGitignore` that reads the `.gitignore` file from `workspaceRoot` and adds its patterns to the `ignore` instance. Handle cases where `.gitignore` is not found. | `src/indexing/fileWalker.ts` |
| **2.6** | ☐ To Do | **Implement `FileWalker.findAllFiles` Method:** In `src/indexing/fileWalker.ts`, add an asynchronous public method `findAllFiles` that first calls `loadGitignore`, then uses `glob` to find all relevant code files (e.g., `**/*.{ts,js,py,cs}`), and finally filters them using the `ignore` instance. | `src/indexing/fileWalker.ts` |
| **2.7** | ☐ To Do | **Create `AstParser` Service File:** Create a new TypeScript file at `src/parsing/astParser.ts`. | `src/parsing/astParser.ts` |
| **2.8** | ☐ To Do | **Implement `AstParser` Constructor:** In `src/parsing/astParser.ts`, add a constructor that initializes a `tree-sitter` `Parser` instance. | `src/parsing/astParser.ts` |
| **2.9** | ☐ To Do | **Implement `AstParser.parse` Method:** In `src/parsing/astParser.ts`, add a public method `parse` that takes `language: 'typescript' | 'python' | 'csharp'` and `code: string`. Use a `switch` statement to set the correct `tree-sitter` language grammar and then parse the provided `code` into an AST, returning the `Parser.Tree`. | `src/parsing/astParser.ts` |
| **2.10** | ☐ To Do | **Create `Chunker` Service File:** Create a new TypeScript file at `src/parsing/chunker.ts`. Define the `CodeChunk` interface within this file, including `filePath`, `content`, `startLine`, `endLine`, and `type`. | `src/parsing/chunker.ts` |
| **2.11** | ☐ To Do | **Implement `Chunker.chunk` Method:** In `src/parsing/chunker.ts`, add a public method `chunk` that takes `filePath: string`, `tree: Parser.Tree`, and `code: string`. Use `tree-sitter`'s `Query` API to find specific nodes (e.g., function declarations, class declarations) in the AST. Iterate through matches and create `CodeChunk` objects, populating their properties from the AST nodes. | `src/parsing/chunker.ts` |
| **2.12** | ☐ To Do | **Update `IndexingService` File:** Open `src/indexing/indexingService.ts`. If it doesn't exist, create it. This file will orchestrate the `FileWalker`, `AstParser`, and `Chunker`. | `src/indexing/indexingService.ts` |
| **2.13** | ☐ To Do | **Implement `IndexingService` Constructor:** In `src/indexing/indexingService.ts`, add a constructor that takes `workspaceRoot: string` and initializes instances of `FileWalker`, `AstParser`, and `Chunker`. | `src/indexing/indexingService.ts` |
| **2.14** | ☐ To Do | **Implement `IndexingService.startIndexing` Method:** In `src/indexing/indexingService.ts`, add an asynchronous public method `startIndexing`. This method should use `vscode.window.withProgress` to show a progress notification. Inside, call `fileWalker.findAllFiles()`. For each file, read its content using `vscode.workspace.fs.readFile`, determine its language, parse it with `astParser.parse()`, and then chunk it with `chunker.chunk()`. Collect all generated `CodeChunk` objects. | `src/indexing/indexingService.ts` |
| **2.15** | ☐ To Do | **Implement `IndexingService.getLanguage` Method:** In `src/indexing/indexingService.ts`, add a private helper method `getLanguage` that takes a `filePath` and returns the corresponding language (e.g., 'typescript', 'python', 'csharp') or `null` based on the file extension. | `src/indexing/indexingService.ts` |
| **2.16** | ☐ To Do | **Integrate `IndexingService` into `extension.ts`:** In `src/extension.ts`, modify the `activate` function to instantiate `IndexingService` and call `startIndexing` when a specific command (e.g., "Index Now") is executed. Ensure proper error handling and user feedback (e.g., `vscode.window.showInformationMessage`). | `src/extension.ts` |
