# Task List: Sprint 3 - Vectorization & DB Integration

**Goal:** To vectorize the code chunks and store them in the Qdrant database.

| Task ID | Status | Task Description (Sequential & Atomic Steps) | File(s) To Modify |
| :--- | :--- | :--- | :--- |
| **3.1** | ☐ To Do | **Install Qdrant Client and Axios:** In your project's root directory, run `npm install @qdrant/js-client-rest axios` to install the Qdrant JavaScript client and an HTTP client for embedding providers. | `package.json` |
| **3.2** | ☐ To Do | **Create Docker Compose File for Qdrant:** In your project's root directory, create a new file named `docker-compose.yml`. | `docker-compose.yml` |
| **3.3** | ☐ To Do | **Add Qdrant Service Definition to Docker Compose:** In `docker-compose.yml`, define the Qdrant service, specifying the `qdrant/qdrant:latest` image, port mappings (`6333:6333`, `6334:6334`), and a volume for persistent storage (`./qdrant_storage:/qdrant/storage`). | `docker-compose.yml` |
| **3.4** | ☐ To Do | **Start Qdrant Container:** From your project's root directory, run `docker-compose up -d` to start the Qdrant database in the background. | `(Terminal Command)` |
| **3.5** | ☐ To Do | **Create `QdrantService` File:** Create a new TypeScript file at `src/db/qdrantService.ts`. | `src/db/qdrantService.ts` |
| **3.6** | ☐ To Do | **Implement `QdrantService` Constructor:** In `src/db/qdrantService.ts`, add a constructor that initializes a `QdrantClient` instance, connecting to the local Qdrant instance (e.g., `http://localhost:6333`). | `src/db/qdrantService.ts` |
| **3.7** | ☐ To Do | **Implement `QdrantService.createCollectionIfNotExists` Method:** In `src/db/qdrantService.ts`, add an asynchronous public method `createCollectionIfNotExists` that takes `collectionName: string`. This method should check if the collection already exists using `client.getCollections()` and, if not, create it using `client.createCollection()` with appropriate vector size and distance (e.g., `size: 768, distance: 'Cosine'`). | `src/db/qdrantService.ts` |
| **3.8** | ☐ To Do | **Implement `QdrantService.upsertChunks` Method:** In `src/db/qdrantService.ts`, add an asynchronous public method `upsertChunks` that takes `collectionName: string`, `chunks: CodeChunk[]`, and `vectors: number[][]`. This method should map `CodeChunk` and `vector` data into `PointStruct` objects and then use `client.upsert()` to insert or update them in the specified collection. | `src/db/qdrantService.ts` |
| **3.9** | ☐ To Do | **Create `IEmbeddingProvider` Interface File:** Create a new TypeScript file at `src/embeddings/embeddingProvider.ts`. Define the `IEmbeddingProvider` interface with a `generateEmbeddings(chunks: string[]): Promise<number[][]>` method. | `src/embeddings/embeddingProvider.ts` |
| **3.10** | ☐ To Do | **Create `OllamaProvider` File:** Create a new TypeScript file at `src/embeddings/ollamaProvider.ts`. | `src/embeddings/ollamaProvider.ts` |
| **3.11** | ☐ To Do | **Implement `OllamaProvider`:** In `src/embeddings/ollamaProvider.ts`, implement the `IEmbeddingProvider` interface. The `generateEmbeddings` method should make HTTP POST requests to the local Ollama API (`http://localhost:11434/api/embeddings`) for each chunk, using a specified model (e.g., `nomic-embed-text`), and return the generated embeddings. | `src/embeddings/ollamaProvider.ts` |
| **3.12** | ☐ To Do | **Create `OpenAIProvider` File:** Create a new TypeScript file at `src/embeddings/openaiProvider.ts`. | `src/embeddings/openaiProvider.ts` |
| **3.13** | ☐ To Do | **Implement `OpenAIProvider`:** In `src/embeddings/openaiProvider.ts`, implement the `IEmbeddingProvider` interface. The `generateEmbeddings` method should make HTTP POST requests to the OpenAI embeddings API (`https://api.openai.com/v1/embeddings`), using a specified model (e.g., `text-embedding-ada-002`), and include the API key from VS Code settings in the authorization header. Handle cases where the API key is missing. | `src/embeddings/openaiProvider.ts` |
| **3.14** | ☐ To Do | **Update `IndexingService` to Use Embedding Provider and Qdrant:** Open `src/indexing/indexingService.ts`. Modify the `IndexingService` to include instances of `QdrantService` and `IEmbeddingProvider`. | `src/indexing/indexingService.ts` |
| **3.15** | ☐ To Do | **Modify `IndexingService.startIndexing` Method:** In `src/indexing/indexingService.ts`, after chunking is complete, add steps to: 1) Extract content from all chunks, 2) Call `embeddingProvider.generateEmbeddings()` to get vectors, 3) Determine a collection name (e.g., based on workspace root), 4) Call `qdrantService.createCollectionIfNotExists()`, and 5) Call `qdrantService.upsertChunks()` to store the chunks and vectors in Qdrant. | `src/indexing/indexingService.ts` |
| **3.16** | ☐ To Do | **Add Progress Reporting for Embedding and Storage:** In `IndexingService.startIndexing`, update `vscode.window.withProgress` to report progress messages for "Generating embeddings..." and "Storing in vector database...". | `src/indexing/indexingService.ts` |
| **3.17** | ☐ To Do | **Add Completion Message:** In `IndexingService.startIndexing`, after successful storage, display a completion message using `vscode.window.showInformationMessage("Indexing complete!")`. | `src/indexing/indexingService.Service` |
